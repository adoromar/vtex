var headers={Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json"},isWishListPage=0<$(".wishlist").length,documentClientId="",wishlistStoreName="adoromar";function onWishListEmpty(){$("#e-get-products").html('<span class="e-wishlist__empty">Ops! Parece que sua lista est√° vazia.</span>')}function wishlist(){$("body").on("click",".e-main-product .js-add-wishlist",function(){return skuJson&&($(this).addClass("e-loading"),saveOnWishlist($(this),skuJson.productId)),!1}),$("body").on("click",".prateleira ul li .js-add-wislist",function(){return $(this).closest("li").find(".e-id").val()&&($(this).addClass("e-loading"),saveOnWishlist($(this),$(this).closest("li").find(".e-id").val())),!1})}function saveOnWishlist(elemento,idProduto){var $this=elemento,wishlistID=idProduto;$.ajax({type:"GET",url:"/no-cache/profileSystem/getProfile",success:function(data){var userEmail=data.Email;if(0==data.IsUserDefined)vtexid.start({returnUrl:"",userEmail:"",locale:"pt-BR",forceReload:!1});else if(1==data.IsUserDefined&&null==data.FirstName)$("#e-userEmail").val(userEmail),$("#e-cadastro-user").show();else{if(addProductWishlist.apply($this,[wishlistID,userEmail]),null==$.cookie("wishlist")||"undefined"==$.cookie("wishlist"))$.cookie("wishlist",wishlistID,{path:"/",expires:1});else{var oldCookie=$.cookie("wishlist").split(/,/);if(-1!=oldCookie.indexOf(wishlistID))var wishlistIDs=$.cookie("wishlist")+","+wishlistID;else{wishlistIDs=oldCookie.remove(wishlistID);wishlistIDs="".concat(wishlistIDs)}$.cookie("wishlist",wishlistIDs,{path:"/",expires:1})}wishlistSelectedsCookie()}},error:function(data){console.log(data),console.log("Ops, ocorreu um erro.")}})}function addProductWishlist(id_produto,userEmail){$(this).each(function(){var $elem=$(this),elemAdded=!0,jsonWishlist={userId:userEmail,productsList:""},getUserId="",idWishList="";$.ajax({headers:headers,type:"GET",url:"https://api.vtexcrm.com.br/"+wishlistStoreName+"/dataentities/CL/search?_where=email="+userEmail+"&_fields=id",success:function(data){$(data).length&&(getUserId=data[0].id,$.ajax({headers:headers,type:"GET",url:"https://api.vtexcrm.com.br/"+wishlistStoreName+"/dataentities/WL/search?_where=userId="+getUserId+"&_fields=id,productsList",success:function(response){if(response[0]){var oldList=response[0].productsList;oldList&&-1!=oldList.indexOf(",")&&(oldList=oldList.split(/,/)),idWishList=response[0].id}var urlWishlist;oldList?-1==oldList.indexOf(id_produto.toString())?jsonWishlist.productsList=oldList+","+id_produto:(Array.isArray(oldList)?(oldList.remove(id_produto.toString()),jsonWishlist.productsList="".concat(oldList)):jsonWishlist.productsList="",elemAdded=!1):jsonWishlist.productsList=id_produto;urlWishlist="https://api.vtexcrm.com.br/"+wishlistStoreName+"/dataentities/WL/documents/"+idWishList,console.log(jsonWishlist),$.ajax({headers:headers,data:JSON.stringify(jsonWishlist),type:"PATCH",url:urlWishlist,success:function(data){console.log("Produto adicionado a wishlist!"),$elem.removeClass("e-loading"),elemAdded?$elem.addClass("e-active"):$elem.removeClass("e-active"),wishlistSelecteds()},error:function(data){console.log(data),console.log("Ops, ocorreu um erro.")}})}}))},error:function(data){console.log(data)}})})}function wishlistSelecteds(){$.ajax({type:"GET",url:"/no-cache/profileSystem/getProfile",success:function(userInfoData){var userEmail=userInfoData.Email;1==userInfoData.IsUserDefined&&1==userInfoData.IsUserDefined&&null!=userInfoData.FirstName&&$.ajax({headers:headers,type:"GET",url:"https://api.vtexcrm.com.br/"+wishlistStoreName+"/dataentities/CL/search?_where=email="+userEmail+"&_fields=id",success:function(data){if($(data).length){var idUser=data[0].id;documentClientId=data[0].id,$.ajax({headers:headers,type:"GET",url:"https://api.vtexcrm.com.br/"+wishlistStoreName+"/dataentities/WL/search?_where=userId="+idUser+"&_fields=id,productsList",success:function(lisData){if($(lisData).length&&lisData[0].productsList){var product_id=lisData[0].productsList.split(/,/g);if(product_id[0]){var numWish=product_id.length,productIdLongString=product_id.filter(function(id){return $.trim(id)}).map(function(id){return"fq=productId:"+id}).join("&");if(console.log("numWish",numWish),isWishListPage){$.ajax("/buscapagina?"+productIdLongString+"&PS="+numWish+"&sl=c73608ab-bb8d-4a5c-8a4f-af8e8180debc&cc=100&sm=0&PageNumber=1",{async:!1}).done(function(data){$("#e-get-products").html(data),$("body").addClass("e-active")}).fail(function(){onWishListEmpty()})}setTimeout(function(){for(var i=0;i<product_id.length;i++)setWishedProducts(product_id[i])},100)}else onWishListEmpty()}else onWishListEmpty()},error:function(data){console.log(data)}})}},error:function(data){console.log(data)}})},error:function(data){console.log(data),console.log("Ops, ocorreu um erro.")}})}function wishlistSelectedsCookie(){if(null!=$.cookie("wishlist"))for(var wishlistCookie=$.cookie("wishlist").split(","),i=0;i<wishlistCookie.length;i++){setWishedProducts(wishlistCookie[i])}}function setWishedProducts(productID){"undefined"!=typeof skuJson_0&&skuJson_0.productId;$("body").hasClass("produto")&&skuJson_0.productId==productID&&$(".e-main-product .js-add-wishlist").addClass("e-active"),$(".prateleira ul li").each(function(){$(this).find(".e-id").val()==productID&&$(this).find(".e-product .js-add-wislist").addClass("e-active")})}function deleteItemWishlist(){$("body").on("click",".e-wishlist-delete",function(event){var element=$(this).closest("li"),id_document=element.data("document"),id=element.data("id").toString();return $.ajax({headers:headers,type:"GET",url:"https://api.vtexcrm.com.br/"+wishlistStoreName+"/dataentities/WL/search?_where=id="+id_document+"&_fields=userId,productsList",success:function(data){var list=data[0].productsList.split(/,/g),index=list.indexOf(id);list.splice(index,1);var newList={productsList:list=list.length&&list[0]?list.join(","):","},urlWishlist="https://api.vtexcrm.com.br/"+wishlistStoreName+"/dataentities/WL/documents/"+id_document;$.ajax({headers:headers,data:JSON.stringify(newList),type:"PATCH",url:urlWishlist,success:function(data){$(element).slideUp(300,function(){element.remove()}),$.cookie("wishlist","")},error:function(data){console.log(data),console.log("Ops, ocorreu um erro.")}})},error:function(data){console.log(data)}}),!1})}function formSaveUserActions(){$("div.e-cadastro-user").on("click",".e-close, .e-not",function(){$("#e-cadastro-user").hide()})}function saveUserWishlist(){$("div.e-cadastro-user div.e-form form").on("submit",function(){var _this=$(this);$(this).find("input.e-next").val("adicionando...");var jsonSaveUser={email:$("#e-userEmail").val(),firstName:$("#e-userName").val(),lastName:$("#e-userLastName").val(),document:$("#e-userDocument").val(),homePhone:"+55"+$("#e-ddd-cel").val()+$("#e-number-cel").val()},urlSaveUser="https://api.vtexcrm.com.br/"+wishlistStoreName+"/dataentities/CL/documents/";return $.ajax({headers:headers,data:JSON.stringify(jsonSaveUser),type:"PATCH",url:urlSaveUser,success:function(data){$("#e-cadastro-user .e-form").html('<div class="e-sucesso">Cadastro feito com sucesso, escolha seus produtos.</div>'),setTimeout(function(){$("#e-cadastro-user").hide()},3e3),window.location.reload()},error:function(data){_this.find("input.e-next").val("Ops! tente novamente")}}),!1})}function callEditWishList(){$(".e-main--right--buttons--edit a").on("click",function(e){var _this=this;e.preventDefault(),_areAuth().done(function(res){res.loggedIn?window.location=$(_this).attr("href"):vtexid.start()})})}function _areAuth(){return vtexjs.checkout.getOrderForm()}$(document).ready(function(){callEditWishList(),wishlist(),wishlistSelecteds(),wishlistSelectedsCookie(),formSaveUserActions(),saveUserWishlist(),deleteItemWishlist()});